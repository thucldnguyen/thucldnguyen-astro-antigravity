---
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import { SITE_TITLE, SITE_DESCRIPTION } from "../consts";
---

<!doctype html>
<html lang="en">
    <head>
        <BaseHead
            title={`Contact Me - ${SITE_TITLE}`}
            description={SITE_DESCRIPTION}
        />
    </head>
    <body
        class="bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-100 transition-colors duration-300"
    >
        <Header />
        <main
            class="w-full max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12 md:py-20"
        >
            <div class="text-center mb-12">
                <h1 class="text-4xl md:text-5xl font-bold tracking-tight mb-4">
                    Let's Connect
                </h1>
                <p
                    class="text-lg text-slate-600 dark:text-slate-400 max-w-2xl mx-auto"
                >
                    Have a question, a project idea, or just want to say hi? I'd
                    love to hear from you. Use the form below or reach out via
                    social media.
                </p>
            </div>

            <div class="glass-form-card max-w-2xl mx-auto">
                <!-- Web3Forms -->
                <form
                    action="https://api.web3forms.com/submit"
                    method="POST"
                    id="contact-form"
                    class="space-y-6"
                >
                    <!-- Access Key -->
                    <input
                        type="hidden"
                        name="access_key"
                        value="f4b673e6-ceb5-47d3-8e7a-9324922941ee"
                    />

                    <!-- Spam Protection (Honeypot) -->
                    <input
                        type="checkbox"
                        name="botcheck"
                        class="hidden"
                        style="display: none;"
                    />

                    <!-- Redirect (optional, handled by JS normally but good fallback) -->
                    <!-- <input type="hidden" name="redirect" value="https://web3forms.com/success"> -->

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label
                                for="name"
                                class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"
                                >Name</label
                            >
                            <input
                                type="text"
                                name="name"
                                id="name"
                                required
                                placeholder="Your Name"
                                class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-800 bg-white/50 dark:bg-slate-900/50 focus:ring-2 focus:ring-violet-600 focus:border-transparent outline-none transition-all"
                            />
                        </div>
                        <div>
                            <label
                                for="email"
                                class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"
                                >Email</label
                            >
                            <input
                                type="email"
                                name="email"
                                id="email"
                                required
                                placeholder="you@example.com"
                                class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-800 bg-white/50 dark:bg-slate-900/50 focus:ring-2 focus:ring-violet-600 focus:border-transparent outline-none transition-all"
                            />
                        </div>
                    </div>

                    <div>
                        <label
                            for="subject"
                            class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"
                            >Subject</label
                        >
                        <input
                            type="text"
                            name="subject"
                            id="subject"
                            required
                            placeholder="What's this about?"
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-800 bg-white/50 dark:bg-slate-900/50 focus:ring-2 focus:ring-violet-600 focus:border-transparent outline-none transition-all"
                        />
                    </div>

                    <div>
                        <label
                            for="message"
                            class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"
                            >Message</label
                        >
                        <textarea
                            name="message"
                            id="message"
                            rows="5"
                            required
                            placeholder="Your message here..."
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-800 bg-white/50 dark:bg-slate-900/50 focus:ring-2 focus:ring-violet-600 focus:border-transparent outline-none transition-all resize-none"
                        ></textarea>
                    </div>

                    <button
                        type="submit"
                        id="submit-btn"
                        class="w-full bg-violet-600 hover:bg-violet-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold py-4 rounded-xl shadow-lg hover:shadow-xl shadow-violet-600/20 transition-all transform hover:-translate-y-1 disabled:hover:translate-y-0"
                    >
                        Send Message
                    </button>
                </form>
            </div>
        </main>
        <Footer />

        <style>
            .glass-form-card {
                background: rgba(
                    255,
                    255,
                    255,
                    0.85
                ); /* Solid fallback for mobile/no-support */
                border: 1px solid rgba(255, 255, 255, 0.3);
                border-radius: 16px;
                box-shadow:
                    0 10px 15px -3px rgba(0, 0, 0, 0.05),
                    0 4px 6px -2px rgba(0, 0, 0, 0.02);
                padding: 2rem;
                position: relative;
                overflow: hidden;
                transition:
                    background-color 0.3s ease,
                    border-color 0.3s ease;
            }

            :global(.dark) .glass-form-card {
                background: rgba(
                    30,
                    41,
                    59,
                    0.85
                ); /* Slightly lighter slate for better depth */
                border: 1px solid rgba(255, 255, 255, 0.15);
                box-shadow:
                    0 20px 25px -5px rgba(0, 0, 0, 0.2),
                    0 10px 10px -5px rgba(0, 0, 0, 0.1);
            }

            @media (min-width: 640px) {
                .glass-form-card {
                    padding: 3rem;
                }

                @supports (backdrop-filter: blur(12px)) or
                    (-webkit-backdrop-filter: blur(12px)) {
                    .glass-form-card {
                        background: rgba(255, 255, 255, 0.25);
                        backdrop-filter: blur(12px) saturate(110%);
                        -webkit-backdrop-filter: blur(12px) saturate(110%);
                    }

                    :global(.dark) .glass-form-card {
                        background: rgba(
                            15,
                            23,
                            42,
                            0.3
                        ); /* Higher transparency for better glass effect */
                        border: 1px solid rgba(255, 255, 255, 0.2);
                        box-shadow:
                            0 25px 50px -12px rgba(0, 0, 0, 0.5),
                            inset 0 1px 1px rgba(255, 255, 255, 0.1);
                    }
                }
            }

            /* Reduced motion preference */
            @media (prefers-reduced-motion: reduce) {
                .glass-form-card {
                    backdrop-filter: none !important;
                    -webkit-backdrop-filter: none !important;
                    transition: none !important;
                }
            }
        </style>

        <!-- Toast Notification -->
        <div
            id="toast"
            class="fixed bottom-8 right-8 z-50 transform transition-all duration-500 translate-y-24 opacity-0"
        >
            <div
                class="glass-panel px-6 py-4 rounded-2xl shadow-2xl flex items-center gap-3 border-l-4 border-green-500"
            >
                <div
                    class="bg-green-100 dark:bg-green-900/30 p-2 rounded-full text-green-600 dark:text-green-400"
                >
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 20 20"
                        fill="currentColor"
                        class="w-5 h-5"
                    >
                        <path
                            fill-rule="evenodd"
                            d="M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z"
                            clip-rule="evenodd"></path>
                    </svg>
                </div>
                <div>
                    <h4
                        class="font-bold text-slate-900 dark:text-white text-sm"
                    >
                        Success!
                    </h4>
                    <p class="text-sm text-slate-600 dark:text-slate-400">
                        Your message has been sent.
                    </p>
                </div>
                <button
                    onclick="hideToast()"
                    class="ml-4 text-slate-400 hover:text-slate-600 dark:hover:text-slate-200"
                >
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 20 20"
                        fill="currentColor"
                        class="w-5 h-5"
                    >
                        <path
                            d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"
                        ></path>
                    </svg>
                </button>
            </div>
        </div>

        <script is:inline>
            const form = document.getElementById("contact-form");
            const submitBtn = document.getElementById("submit-btn");
            const toast = document.getElementById("toast");

            function showToast() {
                toast.classList.remove("translate-y-24", "opacity-0");
                setTimeout(hideToast, 5000);
            }

            function hideToast() {
                toast.classList.add("translate-y-24", "opacity-0");
            }

            // Expose hideToast to global scope
            window.hideToast = hideToast;

            form.addEventListener("submit", function (e) {
                e.preventDefault();
                const formData = new FormData(form);
                const object = Object.fromEntries(formData);
                const json = JSON.stringify(object);

                // Disable button and show loading state
                submitBtn.disabled = true;
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = `
                    <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline shadow-none" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Sending...
                `;

                fetch("https://api.web3forms.com/submit", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        Accept: "application/json",
                    },
                    body: json,
                })
                    .then(async (response) => {
                        let json = await response.json();
                        if (response.status == 200) {
                            showToast();
                            form.reset();
                            submitBtn.innerHTML = "Message Sent!";
                            // Keep button disabled as requested
                        } else {
                            console.log(response);
                            alert(json.message);
                            submitBtn.disabled = false;
                            submitBtn.innerHTML = originalText;
                        }
                    })
                    .catch((error) => {
                        console.log(error);
                        alert("Something went wrong!");
                        submitBtn.disabled = false;
                        submitBtn.innerHTML = originalText;
                    });
            });
        </script>
    </body>
</html>
