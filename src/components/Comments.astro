---
// Giscus comments component
// Configuration should be updated with actual repo details
---

<section class="mt-16 w-full glass-comment-card">
    <div id="giscus-container"></div>

    <script>
        function getGiscusTheme() {
            return document.documentElement.classList.contains("dark")
                ? "transparent_dark"
                : "light";
        }

        const giscusAttributes = {
            src: "https://giscus.app/client.js",
            "data-repo": "thucldnguyen/thucldnguyen-astro-antigravity",
            "data-repo-id": "R_kgDONq8jOQ",
            "data-category": "Announcements",
            "data-category-id": "DIC_kwDONq8jOc4Cl5rY",
            "data-mapping": "pathname",
            "data-strict": "0",
            "data-reactions-enabled": "1",
            "data-emit-metadata": "0",
            "data-input-position": "top",
            "data-theme": getGiscusTheme(),
            "data-lang": "en",
            "data-loading": "lazy",
            crossorigin: "anonymous",
            async: "",
        };

        const giscusContainer = document.getElementById("giscus-container");
        const script = document.createElement("script");

        Object.entries(giscusAttributes).forEach(([key, value]) => {
            script.setAttribute(key, value);
        });

        giscusContainer?.appendChild(script);

        // Listen for theme changes
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (
                    mutation.type === "attributes" &&
                    mutation.attributeName === "class"
                ) {
                    const iframe = document.querySelector<HTMLIFrameElement>(
                        "iframe.giscus-frame",
                    );
                    if (!iframe) return;

                    const theme = getGiscusTheme();
                    iframe.contentWindow?.postMessage(
                        {
                            giscus: {
                                setConfig: {
                                    theme: theme,
                                },
                            },
                        },
                        "https://giscus.app",
                    );
                }
            });
        });

        observer.observe(document.documentElement, {
            attributes: true,
            attributeFilter: ["class"],
        });
    </script>
</section>

<style>
	.glass-comment-card {
		background: rgba(
			255,
			255,
			255,
			0.85
		); /* Solid fallback for mobile/no-support */
		border: 1px solid rgba(255, 255, 255, 0.3);
		border-radius: 16px;
		box-shadow:
			0 10px 15px -3px rgba(0, 0, 0, 0.05),
			0 4px 6px -2px rgba(0, 0, 0, 0.02);
		padding: 2rem;
		position: relative;
		overflow: hidden;
		transition:
			background-color 0.3s ease,
			border-color 0.3s ease;
	}

	:global(.dark) .glass-comment-card {
		background: rgba(
			30,
			41,
			59,
			0.85
		); /* Slightly lighter slate for better depth */
		border: 1px solid rgba(255, 255, 255, 0.15);
		box-shadow:
			0 20px 25px -5px rgba(0, 0, 0, 0.2),
			0 10px 10px -5px rgba(0, 0, 0, 0.1);
	}

	@media (min-width: 640px) {
		.glass-comment-card {
			padding: 3rem;
		}

		@supports (backdrop-filter: blur(12px)) or
			(-webkit-backdrop-filter: blur(12px)) {
			.glass-comment-card {
				background: rgba(255, 255, 255, 0.25);
				backdrop-filter: blur(12px) saturate(110%);
				-webkit-backdrop-filter: blur(12px) saturate(110%);
			}

			:global(.dark) .glass-comment-card {
				background: rgba(
					15,
					23,
					42,
					0.3
				); /* Higher transparency for better glass effect */
				border: 1px solid rgba(255, 255, 255, 0.2);
				box-shadow:
					0 25px 50px -12px rgba(0, 0, 0, 0.5),
					inset 0 1px 1px rgba(255, 255, 255, 0.1);
			}
		}
	}

	/* Reduced motion preference */
	@media (prefers-reduced-motion: reduce) {
		.glass-comment-card {
			backdrop-filter: none !important;
			-webkit-backdrop-filter: none !important;
			transition: none !important;
		}
	}
</style>
